name: Database Keepalive

# ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¡°ê±´
on:
  schedule:
    # ë§¤ ì‹œê°„ ì •ê° + 5ë¶„ì— ì‹¤í–‰ (Vercel Cronê³¼ ì‹œê°„ ê°„ê²© ë‹¤ë¥´ê²Œ)
    - cron: '5 * * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥
  workflow_dispatch:

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Vercel API to keep DB alive
        run: |
          # Vercel ë°°í¬ URL í™•ì¸
          VERCEL_URL="${{ secrets.VERCEL_URL }}"
          
          if [ -z "$VERCEL_URL" ]; then
            echo "âš ï¸ VERCEL_URL secretì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
            echo "ğŸ“ GitHub Settings â†’ Secrets â†’ Actionsì—ì„œ VERCEL_URLì„ ì¶”ê°€í•´ì£¼ì„¸ìš”."
            exit 1
          fi
          
          echo "ğŸ”„ Keepalive ping ì‹¤í–‰ ì¤‘..."
          curl -X GET "https://$VERCEL_URL/api/keepalive" \
            -H "Content-Type: application/json" \
            -w "\nStatus: %{http_code}\n" \
            --max-time 10 \
            --fail-with-body
          
          echo "âœ… Keepalive ì„±ê³µ!"
        env:
          VERCEL_URL: ${{ secrets.VERCEL_URL }}
